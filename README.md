# svpwm executor
---

这个是 simulink 仿真用的一个电机开发板的固件。

算法由 simulink 实现。板子本身只负责“执行” ———— ADC 采样汇报给 simulink, 以及 simulink 下发 pwm 占空比执行。

# 运行模式，板子由2个拨码开关设置 4 个运行模式：


1. 直流电机模式
    这个模式里，ADC 只采样单相电流，并且也只能使用 A B 两个输出半桥。占空比设定 【-32767～+32767】，负号占空比表示反转。这个模式配合 simulink 的算法可以驱动直流有刷电机。

2. SVPWM 模式
   这个模式里，向 simulink 汇报 三相相电流，三相反电动势，还有霍尔状态。占空比可以设定 [-1 ~ +32767], -1 表示设置为悬空相。
   这个模式配合 simulink 的算法可以驱动 无刷电机和异步电机。

---
3. BLDC 模式
   这个模式里，向 simulink 汇报电机转速和电流。占空比可以设定【-32767～+32767】，负号占空比表示反转。需要接霍尔传感器。这个模式配合 simulink 的算法可以把无刷电机当有刷电机看待来做调速实验。而无需处理 FOC/六步换向 算法。

4. VFD 模式
   这个模式里，向 simulink 汇报电机的电流电压。simulink下发的命令为 频率+电压。负频率为反转。油simulink里的算法来独立的设定变频器输出的电压和频率，而无需考虑 1khz 的汇报频率带来的正弦波失圆问题。

注： 3 4 两个模式属于规划，可能不会实现。

---



# simulink

和 simulink 使用 USB CDC 虚拟串口进行通信。要在 simulink 里放置 串口模组。根据运行模式，设置数据的 开始字节，和输出的数据。

板子会以固定 2khz 的速度汇报状态。也就是每 0.5毫秒发送一个数据块。这样控制频率就是 2khz。

对于绝大多数场景下已经足够了。

如果发现控制频率不够，可以修改代码提高汇报频率。但是受限于 PC操作系统和 simulink 本身，可能这种办法有天然的天花板。

故，如果无法满足，可能，需要进行在环仿真。这就交给后来人去研究如何将 at32 和 simulink 集成了。



